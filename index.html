<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TODO OOP List</title>
    <style>
        *{
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: Arial, Helvetica, sans-serif;
        }
        body {
            background-color: skyblue;

        }
        h1{
            text-align: center;
        }
        .container {
            width: 30rem;
            margin: 2rem auto;

        }

        .container .form{
            margin: 1.5em 0;
            display: flex;
            align-items: center;
            border-radius: 5px;
            overflow: hidden;
            background-color: #fff;
        }
        .form input{
            flex-grow: 1;
            border: none;
            outline: none;
            padding: 0.7rem;
           
        }
        .form .btn{
            padding: 0.7rem;
            cursor: pointer;
            background-color: darkblue;
            color: #fff;
        }

        .list .todo {
            background-color: #fff;
            display: flex;          
            align-items: center;
            justify-content: space-between;
            padding: 0.3rem;
            margin-bottom: 1px;
            opacity: .9;
            gap: 1rem;
        }
        .todo p {
            flex-grow: 1;
            cursor: pointer;
        }
        .todo span ,.edit{
            cursor: pointer;
        }
        .removeBtn {
            margin-top: 2rem;
            padding: 0.7rem;
            color: #fff;
            background-color: blue;
            border-radius: 5px;
        }
        
    </style>
</head>
<body>
    <div class="container">
        <h1>Todo OOP List</h1>

        <form action="" class="form" data-form>
            <input type="text" placeholder="todo.." data-input>
            <button class="btn">Submit</button>
        </form>

        <div class="list" data-list>
            <!-- <div class="todo">
                <p>
                    Lorem ipsum dolor sit amet, consectetur adipisicing elit.
                </p>
                <span class="remove">Del</span>
            </div> -->

        </div>
        <div class="removeAll">
            <button class="removeBtn">RemoveAll</button>
        </div>

    </div>

    <script>
        // grab from all ele
        const lists=document.querySelector("[data-list]");
        const input=document.querySelector("[data-input]");
        const form=document.querySelector("[data-form]");
        const removeBtn=document.querySelector(".removeBtn");

        class Storage {
            static addToStorage(todoArr){
                let storage=localStorage.setItem("todo",JSON.stringify(todoArr));
                return storage;
            }

            static getStorage(){
                let storage=localStorage.getItem("todo")=== null ? [] 
                :JSON.parse(localStorage.getItem("todo"));
                return storage;
            }
        }

        let todoArr=Storage.getStorage();
        
        form.addEventListener("submit", e => {
            e.preventDefault();
            if(input.value==="") {
                exit();
            }
            let id=Math.random()*100000;
            let todo=new Todo(id, input.value);
            todoArr=[...todoArr, todo];
                UI.displayData();
                UI.clearInput();
                //UI.removeTodo();
                Storage.addToStorage(todoArr);
                UI.removeAllBtn();
           
            // console.log(todoArr);
           
           
        });

        // make instance
        class Todo{
            constructor(id, todo){
                this.id=id;
                this.todo=todo;
            }
        }

        class UI{
            static displayData(){
                let displayData=todoArr.map(item => {
                    return `   
                                <div class="todo">
                                    <p>
                                        ${item.todo}
                                    </p>
                                    <span class="remove" data-id=${item.id}>Del</span>
                                    <span class="edit" data-id=${item.id}>Edit</span>
                                </div>                            
                            `
                });
                lists.innerHTML= displayData.join(" ");
            }
            static clearInput(){
                input.value="";
            }
            static removeTodo(){
                lists.addEventListener("click", e => {
                    if(e.target.classList.contains("remove")){
                        e.target.parentElement.remove();
                        let btnId=e.target.dataset.id;
                        UI.removeArrayTodo(btnId);
                        UI.removeAllBtn();
                    }
                })
            }
            static removeArrayTodo(id){
                todoArr=todoArr.filter(item => item.id!== +id);
                Storage.addToStorage(todoArr);
            }

            static editBtn(){
                let iconChange=true;
                lists.addEventListener("click", e => {
                    if(e.target.classList.contains("edit")){                        
                        let p=e.target.parentElement.firstElementChild;
                        const btnId=e.target.dataset.id;
                   
                        if(iconChange) {
                            p.setAttribute("contentEditable","true");
                            p.focus();
                            p.style.color="blue";
                            e.target.textContent="Save";
                        }else {
                            e.target.textContent="Edit";
                            p.style.color="black";
                            p.removeAttribute("contentEditable");
                        }
                        iconChange= !iconChange;
                        const newArr=todoArr.findIndex(item => item.id=== +btnId);
                    //console.log(newArr)
                            todoArr[newArr].todo=p.textContent;
                            Storage.addToStorage(todoArr);
                    }               
                        
                });
            }
            static removeAll(){
                    removeBtn.addEventListener('click' , ()=>{
                       
                      todoArr.length=0;
                        localStorage.clear();
                        UI.displayData();
                        UI.removeAllBtn();
                    })
            }

            static removeAllBtn () {
                if(todoArr.length <= 0){
                    removeBtn.style.display="none";
                }else {
                    removeBtn.style.display="flex";
                }
            }
        }
        
       
        window.addEventListener("DOMContentLoaded", ()=>{
            UI.displayData();
            UI.editBtn();
            UI.editBtn();
            UI.removeTodo();
           
            UI.removeAll();
            UI.removeAllBtn();
        })
    </script>

</body>
</html>